var st=Object.defineProperty;var it=(t,e,s)=>e in t?st(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var h=(t,e,s)=>it(t,typeof e!="symbol"?e+"":e,s);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function s(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(n){if(n.ep)return;n.ep=!0;const o=s(n);fetch(n.href,o)}})();class nt{constructor(){this.ids=[],this.values=[],this.length=0}clear(){this.length=0}push(e,s){let i=this.length++;for(;i>0;){const n=i-1>>1,o=this.values[n];if(s>=o)break;this.ids[i]=this.ids[n],this.values[i]=o,i=n}this.ids[i]=e,this.values[i]=s}pop(){if(this.length===0)return;const e=this.ids[0];if(this.length--,this.length>0){const s=this.ids[0]=this.ids[this.length],i=this.values[0]=this.values[this.length],n=this.length>>1;let o=0;for(;o<n;){let r=(o<<1)+1;const c=r+1;let a=this.ids[r],l=this.values[r];const y=this.values[c];if(c<this.length&&y<l&&(r=c,a=this.ids[c],l=y),l>=i)break;this.ids[o]=a,this.values[o]=l,o=r}this.ids[o]=s,this.values[o]=i}return e}peek(){if(this.length!==0)return this.ids[0]}peekValue(){if(this.length!==0)return this.values[0]}shrink(){this.ids.length=this.values.length=this.length}}class rt{constructor(e){h(this,"template");h(this,"items",[]);this.template=e}create(){return this.items.pop()??new this.template}release(e){this.items.push(e)}}class Q{constructor(){h(this,"run");h(this,"timer");h(this,"cancelled")}init(e,s){return this.run=s,this.timer=e,this.cancelled=!1,this}execute(){this.timer.pools.get(Q).release(this),!this.cancelled&&this.run(this.timer)}cancel(){this.cancelled=!0}}class Ce{constructor(){h(this,"run");h(this,"timer");h(this,"cancelled");h(this,"onFrameEnd",()=>this.timer.schedule(this,0))}init(e,s){return this.run=s,this.timer=e,this.cancelled=!1,this.timer.events.frameEnd.add(this.onFrameEnd),this}execute(){if(this.cancelled){this.timer.pools.get(Q).release(this),this.timer.events.frameEnd.delete(this.onFrameEnd);return}this.run(this.timer)}cancel(){this.cancelled=!0}}class G{constructor(){h(this,"run");h(this,"timer");h(this,"cancelled");h(this,"interval")}init(e,s,i){return this.run=s,this.timer=e,this.interval=i,this.cancelled=!1,this}execute(){if(this.cancelled){this.timer.pools.get(G).release(this);return}this.timer.schedule(this,this.interval),this.run(this.timer)}cancel(){this.cancelled=!0}}class ot{constructor(){h(this,"executionTime",0);h(this,"lastExecutionTime",0);h(this,"frameExecutionTime",0);h(this,"speed",0);h(this,"playing",!1);h(this,"requestID",-1);h(this,"queue",new nt);h(this,"pools",new Map);h(this,"events",{frameStart:new Set,frameEnd:new Set});h(this,"loop",(e=performance.now())=>{this.requestID=requestAnimationFrame(this.loop),this.update(e)});[Q,G,Ce].forEach(e=>this.pools.set(e,new rt(e)))}get now(){return this.executionTime}schedule(e,s=1e3){this.queue.push(e,this.executionTime+s)}animation(e,s=1e3){const i=this.pools.get(Ce).create();return i.init(this,e),this.schedule(i,s),i}delay(e,s=1e3){const i=this.pools.get(Q).create();return i.init(this,e),this.schedule(i,s),i}interval(e,s=1e3,i=1e3){const n=this.pools.get(G).create();return n.init(this,e,i),this.schedule(n,s),n}update(e=performance.now()){const s=e-this.lastExecutionTime;this.lastExecutionTime=e,this.events.frameStart.forEach(i=>i(this)),this.frameExecutionTime+=s*this.speed;do{const i=this.queue.peekValue()??1/0;if(i>this.frameExecutionTime)break;this.executionTime=i,this.queue.pop().execute(this)}while(!0);this.executionTime=this.frameExecutionTime,this.events.frameEnd.forEach(i=>i(this))}play(e=1){this.playing||e<0||(this.playing=!0,this.speed=e,this.lastExecutionTime=performance.now(),this.requestID=requestAnimationFrame(this.loop))}stop(){this.playing&&(this.playing=!1,cancelAnimationFrame(this.requestID),this.frameExecutionTime=this.executionTime)}clear(){this.queue.clear()}}class at{constructor({autoStart:e=!0,frameRate:s=1e3/60}={}){h(this,"timer");h(this,"_scenes",new Set);h(this,"_cleanups",new Map);h(this,"render",()=>this._scenes.forEach(e=>e.render()));h(this,"update",()=>this._scenes.forEach(e=>e.update()));this.timer=new ot,this.timer.animation(this.render,0),this.timer.interval(this.update,0,s),e&&this.timer.play()}async enterScene(e){if(this._scenes.has(e))return!1;const s=await e.enter();return this._scenes.add(e),s&&this._cleanups.set(e,s),!0}async leaveScene(e){if(!this._scenes.has(e))return!1;const s=this._cleanups.get(e);return s&&(await s(),this._cleanups.delete(e)),await e.leave(),this._scenes.delete(e),!0}}var $={i8:"i8",ui8:"ui8",ui8c:"ui8c",i16:"i16",ui16:"ui16",i32:"i32",ui32:"ui32",f32:"f32",f64:"f64",eid:"eid"},Ae={i8:"Int8",ui8:"Uint8",ui8c:"Uint8Clamped",i16:"Int16",ui16:"Uint16",i32:"Int32",ui32:"Uint32",eid:"Uint32",f32:"Float32",f64:"Float64"},R={i8:Int8Array,ui8:Uint8Array,ui8c:Uint8ClampedArray,i16:Int16Array,ui16:Uint16Array,i32:Int32Array,ui32:Uint32Array,f32:Float32Array,f64:Float64Array,eid:Uint32Array},Te={uint8:2**8,uint16:2**16,uint32:2**32},ct=t=>e=>Math.ceil(e/t)*t,lt=ct(4),ht=Symbol("storeRef"),ne=Symbol("storeSize"),ut=Symbol("storeMaps"),I=Symbol("storeFlattened"),K=Symbol("storeBase"),ft=Symbol("storeType"),_e=Symbol("storeArrayElementCounts"),V=Symbol("storeSubarrays"),Ue=Symbol("subarrayCursors"),yt=Symbol("subarray"),re=Symbol("parentArray"),Pe=Symbol("tagStore"),Me=Symbol("indexType"),Le=Symbol("indexBytes"),Be=Symbol("isEidType"),C={},dt=(t,e)=>{if(ArrayBuffer.isView(t))t[e]=t.slice(0);else{const s=t[re].slice(0);t[e]=t.map((i,n)=>{const{length:o}=t[n],r=o*n,c=r+o;return s.subarray(r,c)})}},pt=(t,e)=>{t[I]&&t[I].forEach(s=>{ArrayBuffer.isView(s)?s[e]=0:s[e].fill(0)})},mt=(t,e)=>{const s=e*R[t].BYTES_PER_ELEMENT,i=new ArrayBuffer(s),n=new R[t](i);return n[Be]=t===$.eid,n},vt=(t,e,s)=>{const i=t[ne],n=Array(i).fill(0);n[ft]=e,n[Be]=e===$.eid;const o=t[Ue],r=s<=Te.uint8?$.ui8:s<=Te.uint16?$.ui16:$.ui32;if(!s)throw new Error("bitECS - Must define component array length");if(!R[e])throw new Error(`bitECS - Invalid component array property type ${e}`);if(!t[V][e]){const l=t[_e][e],y=new R[e](lt(l*i));y[Me]=Ae[r],y[Le]=R[r].BYTES_PER_ELEMENT,t[V][e]=y}const c=o[e],a=c+i*s;o[e]=a,n[re]=t[V][e].subarray(c,a);for(let l=0;l<i;l++){const y=s*l,Y=y+s;n[l]=n[re].subarray(y,Y),n[l][Me]=Ae[r],n[l][Le]=R[r].BYTES_PER_ELEMENT,n[l][yt]=!0}return n},Re=t=>Array.isArray(t)&&typeof t[0]=="string"&&typeof t[1]=="number",gt=(t,e)=>{const s=Symbol("store");if(!t||!Object.keys(t).length)return C[s]={[ne]:e,[Pe]:!0,[K]:()=>C[s]},C[s];t=JSON.parse(JSON.stringify(t));const i={},n=r=>{const c=Object.keys(r);for(const a of c)Re(r[a])?(i[r[a][0]]||(i[r[a][0]]=0),i[r[a][0]]+=r[a][1]):r[a]instanceof Object&&n(r[a])};n(t);const o={[ne]:e,[ut]:{},[V]:{},[ht]:s,[Ue]:Object.keys(R).reduce((r,c)=>({...r,[c]:0}),{}),[I]:[],[_e]:i};if(t instanceof Object&&Object.keys(t).length){const r=(c,a)=>{if(typeof c[a]=="string")c[a]=mt(c[a],e),c[a][K]=()=>C[s],o[I].push(c[a]);else if(Re(c[a])){const[l,y]=c[a];c[a]=vt(o,l,y),c[a][K]=()=>C[s],o[I].push(c[a])}else c[a]instanceof Object&&(c[a]=Object.keys(c[a]).reduce(r,c[a]));return c};return C[s]=Object.assign(Object.keys(t).reduce(r,t),o),C[s][K]=()=>C[s],C[s]}},P=()=>{const t=[],e=[];t.sort=function(r){const c=Array.prototype.sort.call(this,r);for(let a=0;a<t.length;a++)e[t[a]]=a;return c};const s=r=>t[e[r]]===r;return{add:r=>{s(r)||(e[r]=t.push(r)-1)},remove:r=>{if(!s(r))return;const c=e[r],a=t.pop();a!==r&&(t[c]=a,e[a]=c)},has:s,sparse:e,dense:t,reset:()=>{t.length=0,e.length=0}}},T=Symbol("entityMasks"),X=Symbol("entityComponents"),O=Symbol("entitySparseSet"),D=Symbol("entityArray"),bt=1e5,oe=0,De=bt,he=()=>De,B=[],xt=.01,St=xt,Et=()=>oe,Ct=new Map,ze=t=>{const e=t[me]?B.length?B.shift():oe++:B.length>Math.round(De*St)?B.shift():oe++;if(e>t[pe])throw new Error("bitECS - max entities reached");return t[O].add(e),Ct.set(e,t),t[ue].forEach(s=>{ye(t,s,e)&&de(s,e)}),t[X].set(e,new Set),e},qe=(t,e)=>{if(t[O].has(e)){t[Z].forEach(s=>{Ke(t,s,e)}),t[me]||B.push(e),t[O].remove(e),t[X].delete(e),t[Ve].delete(t[ce].get(e)),t[ce].delete(e);for(let s=0;s<t[T].length;s++)t[T][s][e]=0}},Fe=Symbol("$modifier");function At(t,e){const s=()=>[t,e];return s[Fe]=!0,s}var Tt=t=>At(t,"not"),Z=Symbol("queries"),ue=Symbol("notQueries"),Mt=Symbol("queryAny"),Lt=Symbol("queryAll"),Rt=Symbol("queryNone"),M=Symbol("queryMap"),z=Symbol("$dirtyQueries"),Qe=Symbol("queryComponents"),Ye=Object.freeze([]),It=t=>e=>{e[M].has(t)||fe(e,t);const s=e[M].get(t);if(s.entered.dense.length===0)return Ye;{const i=s.entered.dense.slice();return s.entered.reset(),i}},Ot=t=>e=>{e[M].has(t)||fe(e,t);const s=e[M].get(t);if(s.exited.dense.length===0)return Ye;{const i=s.exited.dense.slice();return s.exited.reset(),i}},fe=(t,e)=>{const s=[],i=[],n=[];e[Qe].forEach(f=>{if(typeof f=="function"&&f[Fe]){const[p,Ee]=f();t[A].has(p)||ae(t,p),Ee==="not"&&i.push(p),Ee==="changed"&&(n.push(p),s.push(p))}else t[A].has(f)||ae(t,f),s.push(f)});const o=f=>t[A].get(f),r=s.concat(i).map(o),c=P(),a=[],l=[],y=P(),Y=P(),He=P(),Je=r.map(f=>f.generationId).reduce((f,p)=>(f.includes(p)||f.push(p),f),[]),ie=(f,p)=>(f[p.generationId]||(f[p.generationId]=0),f[p.generationId]|=p.bitflag,f),Xe=s.map(o).reduce(ie,{}),Ze=i.map(o).reduce(ie,{}),et=r.reduce(ie,{}),tt=s.filter(f=>!f[Pe]).map(f=>Object.getOwnPropertySymbols(f).includes(I)?f[I]:[f]).reduce((f,p)=>f.concat(p),[]),N=Object.assign(c,{archetypes:a,changed:l,components:s,notComponents:i,changedComponents:n,allComponents:r,masks:Xe,notMasks:Ze,hasMasks:et,generations:Je,flatProps:tt,toRemove:y,entered:Y,exited:He,shadows:[]});t[M].set(e,N),t[Z].add(N),r.forEach(f=>{f.queries.add(N)}),i.length&&t[ue].add(N);for(let f=0;f<Et();f++){if(!t[O].has(f))continue;ye(t,N,f)&&de(N,f)}},kt=(t,e)=>{const s=Symbol(),i=t.flatProps[e];return dt(i,s),t.shadows[e]=i[s],i[s]},Nt=(t,e)=>{e&&(t.changed=[]);const{flatProps:s,shadows:i}=t;for(let n=0;n<t.dense.length;n++){const o=t.dense[n];let r=!1;for(let c=0;c<s.length;c++){const a=s[c],l=i[c]||kt(t,c);if(ArrayBuffer.isView(a[o])){for(let y=0;y<a[o].length;y++)if(a[o][y]!==l[o][y]){r=!0;break}l[o].set(a[o])}else a[o]!==l[o]&&(r=!0,l[o]=a[o])}r&&t.changed.push(o)}return t.changed},g=(...t)=>{let e,s,i,n;if(Array.isArray(t[0])&&(e=t[0]),e===void 0||e[A]!==void 0)return r=>r?r[D]:e[D];const o=function(r,c=!0){r[M].has(o)||fe(r,o);const a=r[M].get(o);return wt(r),a.changedComponents.length?Nt(a,c):a.dense};return o[Qe]=e,o[Mt]=s,o[Lt]=i,o[Rt]=n,o},ye=(t,e,s)=>{const{masks:i,notMasks:n,generations:o}=e;for(let r=0;r<o.length;r++){const c=o[r],a=i[c],l=n[c],y=t[T][c][s];if(l&&y&l||a&&(y&a)!==a)return!1}return!0},de=(t,e)=>{t.toRemove.remove(e),t.entered.add(e),t.add(e)},$t=t=>{for(let e=t.toRemove.dense.length-1;e>=0;e--){const s=t.toRemove.dense[e];t.toRemove.remove(s),t.remove(s)}},wt=t=>{t[z].size&&(t[z].forEach($t),t[z].clear())},Ke=(t,e,s)=>{!e.has(s)||e.toRemove.has(s)||(e.toRemove.add(s),t[z].add(e),e.exited.add(s))},A=Symbol("componentMap"),x=(t,e)=>{const s=gt(t,he());return t&&Object.keys(t).length,s},jt=t=>{t[q]*=2,t[q]>=2**31&&(t[q]=1,t[T].push(new Uint32Array(t[pe])))},ae=(t,e)=>{if(!e)throw new Error("bitECS - Cannot register null or undefined component");const s=new Set,i=new Set,n=new Set;t[Z].forEach(o=>{o.allComponents.includes(e)&&s.add(o)}),t[A].set(e,{generationId:t[T].length-1,bitflag:t[q],store:e,queries:s,notQueries:i,changedQueries:n}),jt(t)},_t=(t,e,s)=>{const i=t[A].get(e);if(!i)return!1;const{generationId:n,bitflag:o}=i;return(t[T][n][s]&o)===o},S=(t,e,s,i=!1)=>{if(s===void 0)throw new Error("bitECS - entity is undefined.");if(!t[O].has(s))throw new Error("bitECS - entity does not exist in the world.");if(t[A].has(e)||ae(t,e),_t(t,e,s))return;const n=t[A].get(e),{generationId:o,bitflag:r,queries:c,notQueries:a}=n;t[T][o][s]|=r,c.forEach(l=>{l.toRemove.remove(s);const y=ye(t,l,s);y&&(l.exited.remove(s),de(l,s)),y||(l.entered.remove(s),Ke(t,l,s))}),t[X].get(s).add(e),i&&pt(e,s)},pe=Symbol("size"),q=Symbol("bitflag"),Ut=Symbol("archetypes"),Ve=Symbol("localEntities"),ce=Symbol("localEntityLookup"),me=Symbol("manualEntityRecycling"),Pt=(...t)=>{const e=typeof t[0]=="object"?t[0]:{},s=typeof t[0]=="number"?t[0]:typeof t[1]=="number"?t[1]:he();return Bt(e,s),e},Bt=(t,e=he())=>(t[pe]=e,t[D]&&t[D].forEach(s=>qe(t,s)),t[T]=[new Uint32Array(e)],t[X]=new Map,t[Ut]=[],t[O]=P(),t[D]=t[O].dense,t[q]=1,t[A]=new Map,t[M]=new Map,t[Z]=new Set,t[ue]=new Set,t[z]=new Set,t[Ve]=new Map,t[ce]=new Map,t[me]=!1,t),Ie=(...t)=>e=>{let s=e;for(let i=0;i<t.length;i++){const n=t[i];s=n(s)}return s},m=$,E=(t=>(t[t.RED=0]="RED",t[t.BLUE=1]="BLUE",t[t.GREEN=2]="GREEN",t))(E||{}),U=(t=>(t[t.BLACK=0]="BLACK",t[t.CYAN=1]="CYAN",t))(U||{});const b=x({index:m.ui32});function Oe(t,e){S(t,b,e),b.index[e]=0}const j=x({x:m.f32,y:m.f32});function Dt(t,e,s,i){S(t,j,e),j.x[e]=s,j.y[e]=i}const H=x({index:m.ui16});function zt(t,e){S(t,H,e),H.index[e]=0}const u=x({x:m.f32,y:m.f32});function We(t,e,s,i){S(t,u,e),u.x[e]=s,u.y[e]=i}const F=x({value:m.f32});function qt(t,e,s){S(t,F,e),F.value[e]=s}const v=x({x:m.f32,y:m.f32});function ke(t,e,s,i){S(t,v,e),v.x[e]=s,v.y[e]=i}class Ft{constructor(){h(this,"_states");h(this,"onKeyDown",e=>{this._states.set(e.code,!0)});h(this,"onKeyUp",e=>{this._states.set(e.code,!1)});h(this,"onBlur",e=>{this._states.forEach((s,i)=>this._states.set(i,!1))});this._states=new Map}getState(e){return this._states.get(e)??!1}attach(e){e.addEventListener("keydown",this.onKeyDown),e.addEventListener("keyup",this.onKeyUp),window.addEventListener("blur",this.onBlur)}detach(e){e.removeEventListener("keydown",this.onKeyDown),e.removeEventListener("keyup",this.onKeyUp),window.removeEventListener("blur",this.onBlur)}}class Qt{constructor(e=new OffscreenCanvas(0,0)){h(this,"texture");h(this,"context");h(this,"events",{resize:new Set});this.texture=e,this.context=this.texture.getContext("2d")}resize(e=300,s=e){this.texture.width=e,this.texture.height=s,this.events.resize.forEach(i=>i({width:e,height:s}))}clear(){this.context.clearRect(0,0,this.texture.width,this.texture.height)}}class Yt extends Qt{constructor(e=document.createElement("canvas")){super(e)}isClientSize(){return this.texture.width==this.texture.clientWidth&&this.texture.height==this.texture.clientHeight}toClientSize(){this.resize(this.texture.clientWidth,this.texture.clientHeight)}}const w=x({value:m.ui8});function Kt(t,e,s){S(t,w,e),w.value[e]=s}const d=x({value:m.f32});function Ge(t,e,s){S(t,d,e),d.value[e]=s}function Ne(t,{x:e=0,y:s=0,radius:i=5,appearence:n=E.BLUE}={}){const o=ze(t);return We(t,o,e,s),Ge(t,o,i),Kt(t,o,n),o}const _=x({x:m.f32,y:m.f32});function Vt(t,e,s,i){S(t,_,e),_.x[e]=s,_.y[e]=i}const J=x({value:m.ui8});function Wt(t,e,s){S(t,J,e),J.value[e]=s}function $e(t,{x:e=0,y:s=0,px:i=0,py:n=0,radius:o=5,appearence:r=U.CYAN}={}){const c=ze(t);return We(t,c,e,s),Ge(t,c,o),Wt(t,c,r),Vt(t,c,i,n),c}class ve{constructor(e,s=0){this.bounds={x:e.x||0,y:e.y||0,width:e.width,height:e.height},this.maxObjects=typeof e.maxObjects=="number"?e.maxObjects:10,this.maxLevels=typeof e.maxLevels=="number"?e.maxLevels:4,this.level=s,this.objects=[],this.nodes=[]}getIndex(e){return e.qtIndex(this.bounds)}split(){const e=this.level+1,s=this.bounds.width/2,i=this.bounds.height/2,n=this.bounds.x,o=this.bounds.y,r=[{x:n+s,y:o},{x:n,y:o},{x:n,y:o+i},{x:n+s,y:o+i}];for(let c=0;c<4;c++)this.nodes[c]=new ve({x:r[c].x,y:r[c].y,width:s,height:i,maxObjects:this.maxObjects,maxLevels:this.maxLevels},e)}insert(e){if(this.nodes.length){const s=this.getIndex(e);for(let i=0;i<s.length;i++)this.nodes[s[i]].insert(e);return}if(this.objects.push(e),this.objects.length>this.maxObjects&&this.level<this.maxLevels){this.nodes.length||this.split();for(let s=0;s<this.objects.length;s++){const i=this.getIndex(this.objects[s]);for(let n=0;n<i.length;n++)this.nodes[i[n]].insert(this.objects[s])}this.objects=[]}}retrieve(e){const s=this.getIndex(e);let i=this.objects;if(this.nodes.length)for(let n=0;n<s.length;n++)i=i.concat(this.nodes[s[n]].retrieve(e));return this.level===0?Array.from(new Set(i)):i}remove(e,s=!1){const i=this.objects.indexOf(e);i>-1&&this.objects.splice(i,1);for(let n=0;n<this.nodes.length;n++)this.nodes[n].remove(e);return this.level===0&&!s&&this.join(),i!==-1}update(e,s=!1){this.remove(e,s),this.insert(e)}join(){let e=Array.from(this.objects);for(let i=0;i<this.nodes.length;i++){const n=this.nodes[i].join();e=e.concat(n)}const s=Array.from(new Set(e));if(s.length<=this.maxObjects){this.objects=s;for(let i=0;i<this.nodes.length;i++)this.nodes[i].objects=[];this.nodes=[]}return e}clear(){this.objects=[];for(let e=0;e<this.nodes.length;e++)this.nodes.length&&this.nodes[e].clear();this.nodes=[]}}class ee{constructor(e){this.x=e.x,this.y=e.y,this.r=e.r,this.data=e.data}qtIndex(e){const s=[],i=e.width/2,n=e.height/2,o=e.x+i,r=e.y+n,c=[[o,e.y],[e.x,e.y],[e.x,r],[o,r]];for(let a=0;a<c.length;a++)ee.intersectRect(this.x,this.y,this.r,c[a][0],c[a][1],c[a][0]+i,c[a][1]+n)&&s.push(a);return s}static intersectRect(e,s,i,n,o,r,c){const a=e-Math.max(n,Math.min(e,r)),l=s-Math.max(o,Math.min(s,c));return a*a+l*l<i*i}}var te=(t=>(t[t.CIRCLE_QUADTREE=0]="CIRCLE_QUADTREE",t[t.CIRCLE_COLLISION=1]="CIRCLE_COLLISION",t[t.INVENTORY=2]="INVENTORY",t))(te||{});const W=[];function Gt({entity:t,check:e=!1}={}){return{type:te.CIRCLE_COLLISION,entity:t,check:e}}const we=[];function Ht({entity:t}={}){const e=new ee({x:u.x[t],y:u.y[t],r:d.value[t]});return e.entity=t,e.type=te.CIRCLE_QUADTREE,e}const ge=x();function Jt(t,e){S(t,ge,e)}function le({componentRef:t,query:e,data:s,factory:i}){const n=It(e),o=Ot(e);return r=>{for(const c of n(r))t[c]=s.push(i(c))-1;for(const c of o(r)){const a=s.pop();t[c]!==s.length&&(t[a.entity]=t[c],s[t[c]]=a)}}}function Xt({world:t}){const e=g([u,d,b]),s=g([u,d,b,ge]),i=new ve({x:-500,y:-500,width:1e3,height:1e3,maxObjects:10}),n=le({componentRef:b.index,query:g([u,d,b]),data:W,factory:r=>Gt({entity:r,check:!1})}),o=le({componentRef:b.index,query:g([u,d,b]),data:we,factory:r=>Ht({entity:r})});return()=>{n(t),o(t),i.clear();for(const r of e(t)){const c=b.index[r],a=we[c];a.x=u.x[r]-d.value[r],a.y=u.y[r]-d.value[r],a.r=d.value[r];const l=W[c];l.check=!1,i.insert(a)}for(const r of s(t)){const c=new ee({x:u.x[r],y:u.y[r],r:d.value[r]}),a=i.retrieve(c);for(const l of a){if(l.entity===r)continue;const y=b.index[l.entity];Math.hypot(u.x[r]-u.x[l.entity],u.y[r]-u.y[l.entity])>d.value[r]+d.value[l.entity]||(W[y].check=!0)}}}}var L=(t=>(t[t.SMALL=0]="SMALL",t[t.MEDIUM=1]="MEDIUM",t[t.LARGE=2]="LARGE",t))(L||{});const be=[];be[L.SMALL]={type:L.SMALL,name:"Small inventory",slots:10};be[L.MEDIUM]={type:L.MEDIUM,name:"Medium inventory",slots:20};be[L.LARGE]={type:L.LARGE,name:"Large inventory",slots:30};var k=(t=>(t[t.STONE=0]="STONE",t[t.WATER=1]="WATER",t[t.TITANIUM=2]="TITANIUM",t))(k||{});const xe=[];xe[k.STONE]={type:k.STONE,name:"Stone",maxStack:64};xe[k.WATER]={type:k.WATER,name:"Water",maxStack:64};xe[k.TITANIUM]={type:k.TITANIUM,name:"Titanium",maxStack:12};const Zt=[];function es({entity:t,inventory:e}){return{type:te.INVENTORY,inventory:e,entity:t,stacks:[]}}function ts(t){const e=le({componentRef:H.index,query:g([H]),data:Zt,factory:s=>es({entity:s,inventory:L.SMALL})});return()=>{e(t)}}function ss(t){const e=g([u,v]),s=g([v,j]);return()=>{for(const i of e(t))u.x[i]+=v.x[i],u.y[i]+=v.y[i];for(const i of s(t))v.x[i]*=j.x[i],v.y[i]*=j.y[i]}}function is(t){const e=g([_,u,d]),s=g([u]);return()=>{const i=s(t);for(const n of e(t))for(const o of i){if(n===o)continue;const r=u.x[n]-u.x[o],c=u.y[n]-u.y[o];Math.hypot(r,c)>d.value[n]||(u.x[o]=_.x[n]+r*2,u.y[o]=_.y[n]+c*2)}}}const se=[];se[E.RED]={fillColor:"#ff000055",strokeColor:"#ff0000"};se[E.BLUE]={fillColor:"#0000ff55",strokeColor:"#0000ff"};se[E.GREEN]={fillColor:"#00ff0055",strokeColor:"#00ff00"};const Se=[];Se[U.BLACK]={fillColor:"#000",strokeColor:"#000"};Se[U.CYAN]={fillColor:"#00b5b550",strokeColor:"#00b5b5b5"};const je=Math.PI*2;function ns({world:t,context:e,camera:s}){const i=g([u,d,w]),n=g([u,d,J]),o=g([u,d,w,b,Tt(ge)]);return()=>{for(const a of o(t)){const l=W[b.index[a]];w.value[a]=l.check?E.RED:E.BLUE}e.clearRect(0,0,e.canvas.width,e.canvas.height),e.save();const{width:r,height:c}=e.canvas;e.translate(r/2,c/2),e.scale(s.scale,s.scale),e.translate(-s.x,-s.y);for(let a of i(t)){const l=se[w.value[a]];e.fillStyle=l.fillColor,e.strokeStyle=l.strokeColor,e.beginPath(),e.arc(u.x[a],u.y[a],d.value[a],0,je),e.fill(),e.stroke()}for(let a of n(t)){const l=Se[J.value[a]];e.fillStyle=l.fillColor,e.strokeStyle=l.strokeColor,e.beginPath(),e.arc(u.x[a],u.y[a],d.value[a],0,je),e.fill(),e.stroke()}e.restore()}}class rs{constructor({x:e=0,y:s=e,scale:i=1}={}){h(this,"x");h(this,"y");h(this,"scale");this.x=e,this.y=s,this.scale=i}}function os(t){const e=g([F]);return()=>{for(const s of e(t))F.value[s]-=1,F.value[s]<=0&&qe(t,s)}}class as{constructor(e){h(this,"application");h(this,"screen");h(this,"world");h(this,"camera");h(this,"keyboard");h(this,"player");h(this,"portal");h(this,"portal1");h(this,"updateSystems");h(this,"renderSystems");h(this,"spawnRandomCircle",()=>{const e=Ne(this.world,{appearence:Math.random()>.5?E.RED:E.BLUE});qt(this.world,e,Math.random()*300),ke(this.world,e,Math.random()*5-2.5,Math.random()*5-2.5),Oe(this.world,e)});this.application=e.application,this.screen=new Yt,this.world=Pt(),this.camera=new rs,this.keyboard=new Ft,this.player=Ne(this.world,{radius:20,appearence:E.GREEN}),Jt(this.world,this.player),ke(this.world,this.player,0,0),Dt(this.world,this.player,.9,.9),Oe(this.world,this.player),zt(this.world,this.player),this.renderSystems=Ie(ns({world:this.world,context:this.screen.context,camera:this.camera})),this.updateSystems=Ie(ts(this.world),ss(this.world),is(this.world),os(this.world),Xt({world:this.world})),this.portal=$e(this.world,{x:400,y:0,px:-400,py:0,radius:20,appearence:U.CYAN}),this.portal1=$e(this.world,{x:-400,y:0,px:400,py:0,radius:20,appearence:U.CYAN})}async enter(){const e=this.application.timer.interval(this.spawnRandomCircle,0,16.666666666666668);return this.keyboard.attach(document.body),()=>{e.cancel()}}async leave(){this.keyboard.detach(document.body)}render(){this.screen.isClientSize()||this.screen.toClientSize();const s=u.x[this.player]-this.camera.x,i=u.y[this.player]-this.camera.y;this.camera.x+=s*.1,this.camera.y+=i*.1,this.renderSystems()}update(){(this.keyboard.getState("ArrowRight")||this.keyboard.getState("KeyD"))&&(v.x[this.player]+=1),(this.keyboard.getState("ArrowLeft")||this.keyboard.getState("KeyA"))&&(v.x[this.player]-=1),(this.keyboard.getState("ArrowUp")||this.keyboard.getState("KeyW"))&&(v.y[this.player]-=1),(this.keyboard.getState("ArrowDown")||this.keyboard.getState("KeyS"))&&(v.y[this.player]+=1),this.updateSystems()}}async function cs(){const t=new at,e=new as({application:t});await t.enterScene(e)&&document.querySelector("#app").append(e.screen.texture)}document.addEventListener("DOMContentLoaded",cs);
