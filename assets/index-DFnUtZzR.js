var Ue=Object.defineProperty;var Be=(t,e,s)=>e in t?Ue(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var h=(t,e,s)=>Be(t,typeof e!="symbol"?e+"":e,s);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function s(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(n){if(n.ep)return;n.ep=!0;const a=s(n);fetch(n.href,a)}})();class Ne{constructor(){this.ids=[],this.values=[],this.length=0}clear(){this.length=0}push(e,s){let i=this.length++;for(;i>0;){const n=i-1>>1,a=this.values[n];if(s>=a)break;this.ids[i]=this.ids[n],this.values[i]=a,i=n}this.ids[i]=e,this.values[i]=s}pop(){if(this.length===0)return;const e=this.ids[0];if(this.length--,this.length>0){const s=this.ids[0]=this.ids[this.length],i=this.values[0]=this.values[this.length],n=this.length>>1;let a=0;for(;a<n;){let r=(a<<1)+1;const o=r+1;let c=this.ids[r],l=this.values[r];const f=this.values[o];if(o<this.length&&f<l&&(r=o,c=this.ids[o],l=f),l>=i)break;this.ids[a]=c,this.values[a]=l,a=r}this.ids[a]=s,this.values[a]=i}return e}peek(){if(this.length!==0)return this.ids[0]}peekValue(){if(this.length!==0)return this.values[0]}shrink(){this.ids.length=this.values.length=this.length}}class Pe{constructor(e){h(this,"template");h(this,"items",[]);this.template=e}create(){return this.items.pop()??new this.template}release(e){this.items.push(e)}}class q{constructor(){h(this,"run");h(this,"timer");h(this,"cancelled")}init(e,s){return this.run=s,this.timer=e,this.cancelled=!1,this}execute(){this.timer.pools.get(q).release(this),!this.cancelled&&this.run(this.timer)}cancel(){this.cancelled=!0}}class le{constructor(){h(this,"run");h(this,"timer");h(this,"cancelled");h(this,"onFrameEnd",()=>this.timer.schedule(this,0))}init(e,s){return this.run=s,this.timer=e,this.cancelled=!1,this.timer.events.frameEnd.add(this.onFrameEnd),this}execute(){if(this.cancelled){this.timer.pools.get(q).release(this),this.timer.events.frameEnd.delete(this.onFrameEnd);return}this.run(this.timer)}cancel(){this.cancelled=!0}}class D{constructor(){h(this,"run");h(this,"timer");h(this,"cancelled");h(this,"interval")}init(e,s,i){return this.run=s,this.timer=e,this.interval=i,this.cancelled=!1,this}execute(){if(this.cancelled){this.timer.pools.get(D).release(this);return}this.timer.schedule(this,this.interval),this.run(this.timer)}cancel(){this.cancelled=!0}}class qe{constructor(){h(this,"executionTime",0);h(this,"lastExecutionTime",0);h(this,"frameExecutionTime",0);h(this,"speed",0);h(this,"playing",!1);h(this,"requestID",-1);h(this,"queue",new Ne);h(this,"pools",new Map);h(this,"events",{frameStart:new Set,frameEnd:new Set});h(this,"loop",(e=performance.now())=>{this.requestID=requestAnimationFrame(this.loop),this.update(e)});[q,D,le].forEach(e=>this.pools.set(e,new Pe(e)))}get now(){return this.executionTime}schedule(e,s=1e3){this.queue.push(e,this.executionTime+s)}animation(e,s=1e3){const i=this.pools.get(le).create();return i.init(this,e),this.schedule(i,s),i}delay(e,s=1e3){const i=this.pools.get(q).create();return i.init(this,e),this.schedule(i,s),i}interval(e,s=1e3,i=1e3){const n=this.pools.get(D).create();return n.init(this,e,i),this.schedule(n,s),n}update(e=performance.now()){const s=e-this.lastExecutionTime;this.lastExecutionTime=e,this.events.frameStart.forEach(i=>i(this)),this.frameExecutionTime+=s*this.speed;do{const i=this.queue.peekValue()??1/0;if(i>this.frameExecutionTime)break;this.executionTime=i,this.queue.pop().execute(this)}while(!0);this.executionTime=this.frameExecutionTime,this.events.frameEnd.forEach(i=>i(this))}play(e=1){this.playing||e<0||(this.playing=!0,this.speed=e,this.lastExecutionTime=performance.now(),this.requestID=requestAnimationFrame(this.loop))}stop(){this.playing&&(this.playing=!1,cancelAnimationFrame(this.requestID),this.frameExecutionTime=this.executionTime)}clear(){this.queue.clear()}}class ze{constructor({autoStart:e=!0,frameRate:s=1e3/60}={}){h(this,"timer");h(this,"_scenes",new Set);h(this,"_cleanups",new Map);h(this,"render",()=>this._scenes.forEach(e=>e.render()));h(this,"update",()=>this._scenes.forEach(e=>e.update()));this.timer=new qe,this.timer.animation(this.render,0),this.timer.interval(this.update,0,s),e&&this.timer.play()}async enterScene(e){if(this._scenes.has(e))return!1;const s=await e.enter();return this._scenes.add(e),s&&this._cleanups.set(e,s),!0}async leaveScene(e){if(!this._scenes.has(e))return!1;const s=this._cleanups.get(e);return s&&(await s(),this._cleanups.delete(e)),await e.leave(),this._scenes.delete(e),!0}}class te{constructor(e,s=0){this.bounds={x:e.x||0,y:e.y||0,width:e.width,height:e.height},this.maxObjects=typeof e.maxObjects=="number"?e.maxObjects:10,this.maxLevels=typeof e.maxLevels=="number"?e.maxLevels:4,this.level=s,this.objects=[],this.nodes=[]}getIndex(e){return e.qtIndex(this.bounds)}split(){const e=this.level+1,s=this.bounds.width/2,i=this.bounds.height/2,n=this.bounds.x,a=this.bounds.y,r=[{x:n+s,y:a},{x:n,y:a},{x:n,y:a+i},{x:n+s,y:a+i}];for(let o=0;o<4;o++)this.nodes[o]=new te({x:r[o].x,y:r[o].y,width:s,height:i,maxObjects:this.maxObjects,maxLevels:this.maxLevels},e)}insert(e){if(this.nodes.length){const s=this.getIndex(e);for(let i=0;i<s.length;i++)this.nodes[s[i]].insert(e);return}if(this.objects.push(e),this.objects.length>this.maxObjects&&this.level<this.maxLevels){this.nodes.length||this.split();for(let s=0;s<this.objects.length;s++){const i=this.getIndex(this.objects[s]);for(let n=0;n<i.length;n++)this.nodes[i[n]].insert(this.objects[s])}this.objects=[]}}retrieve(e){const s=this.getIndex(e);let i=this.objects;if(this.nodes.length)for(let n=0;n<s.length;n++)i=i.concat(this.nodes[s[n]].retrieve(e));return this.level===0?Array.from(new Set(i)):i}remove(e,s=!1){const i=this.objects.indexOf(e);i>-1&&this.objects.splice(i,1);for(let n=0;n<this.nodes.length;n++)this.nodes[n].remove(e);return this.level===0&&!s&&this.join(),i!==-1}update(e,s=!1){this.remove(e,s),this.insert(e)}join(){let e=Array.from(this.objects);for(let i=0;i<this.nodes.length;i++){const n=this.nodes[i].join();e=e.concat(n)}const s=Array.from(new Set(e));if(s.length<=this.maxObjects){this.objects=s;for(let i=0;i<this.nodes.length;i++)this.nodes[i].objects=[];this.nodes=[]}return e}clear(){this.objects=[];for(let e=0;e<this.nodes.length;e++)this.nodes.length&&this.nodes[e].clear();this.nodes=[]}}class K{constructor(e){this.x=e.x,this.y=e.y,this.r=e.r,this.data=e.data}qtIndex(e){const s=[],i=e.width/2,n=e.height/2,a=e.x+i,r=e.y+n,o=[[a,e.y],[e.x,e.y],[e.x,r],[a,r]];for(let c=0;c<o.length;c++)K.intersectRect(this.x,this.y,this.r,o[c][0],o[c][1],o[c][0]+i,o[c][1]+n)&&s.push(c);return s}static intersectRect(e,s,i,n,a,r,o){const c=e-Math.max(n,Math.min(e,r)),l=s-Math.max(a,Math.min(s,o));return c*c+l*l<i*i}}var w={i8:"i8",ui8:"ui8",ui8c:"ui8c",i16:"i16",ui16:"ui16",i32:"i32",ui32:"ui32",f32:"f32",f64:"f64",eid:"eid"},ue={i8:"Int8",ui8:"Uint8",ui8c:"Uint8Clamped",i16:"Int16",ui16:"Uint16",i32:"Int32",ui32:"Uint32",eid:"Uint32",f32:"Float32",f64:"Float64"},A={i8:Int8Array,ui8:Uint8Array,ui8c:Uint8ClampedArray,i16:Int16Array,ui16:Uint16Array,i32:Int32Array,ui32:Uint32Array,f32:Float32Array,f64:Float64Array,eid:Uint32Array},fe={uint8:2**8,uint16:2**16,uint32:2**32},Fe=t=>e=>Math.ceil(e/t)*t,De=Fe(4),Ke=Symbol("storeRef"),H=Symbol("storeSize"),Qe=Symbol("storeMaps"),T=Symbol("storeFlattened"),z=Symbol("storeBase"),Ve=Symbol("storeType"),be=Symbol("storeArrayElementCounts"),F=Symbol("storeSubarrays"),xe=Symbol("subarrayCursors"),We=Symbol("subarray"),J=Symbol("parentArray"),Se=Symbol("tagStore"),de=Symbol("indexType"),ye=Symbol("indexBytes"),Ee=Symbol("isEidType"),x={},Ye=(t,e)=>{if(ArrayBuffer.isView(t))t[e]=t.slice(0);else{const s=t[J].slice(0);t[e]=t.map((i,n)=>{const{length:a}=t[n],r=a*n,o=r+a;return s.subarray(r,o)})}},Ge=(t,e)=>{t[T]&&t[T].forEach(s=>{ArrayBuffer.isView(s)?s[e]=0:s[e].fill(0)})},He=(t,e)=>{const s=e*A[t].BYTES_PER_ELEMENT,i=new ArrayBuffer(s),n=new A[t](i);return n[Ee]=t===w.eid,n},Je=(t,e,s)=>{const i=t[H],n=Array(i).fill(0);n[Ve]=e,n[Ee]=e===w.eid;const a=t[xe],r=s<=fe.uint8?w.ui8:s<=fe.uint16?w.ui16:w.ui32;if(!s)throw new Error("bitECS - Must define component array length");if(!A[e])throw new Error(`bitECS - Invalid component array property type ${e}`);if(!t[F][e]){const l=t[be][e],f=new A[e](De(l*i));f[de]=ue[r],f[ye]=A[r].BYTES_PER_ELEMENT,t[F][e]=f}const o=a[e],c=o+i*s;a[e]=c,n[J]=t[F][e].subarray(o,c);for(let l=0;l<i;l++){const f=s*l,Y=f+s;n[l]=n[J].subarray(f,Y),n[l][de]=ue[r],n[l][ye]=A[r].BYTES_PER_ELEMENT,n[l][We]=!0}return n},me=t=>Array.isArray(t)&&typeof t[0]=="string"&&typeof t[1]=="number",Xe=(t,e)=>{const s=Symbol("store");if(!t||!Object.keys(t).length)return x[s]={[H]:e,[Se]:!0,[z]:()=>x[s]},x[s];t=JSON.parse(JSON.stringify(t));const i={},n=r=>{const o=Object.keys(r);for(const c of o)me(r[c])?(i[r[c][0]]||(i[r[c][0]]=0),i[r[c][0]]+=r[c][1]):r[c]instanceof Object&&n(r[c])};n(t);const a={[H]:e,[Qe]:{},[F]:{},[Ke]:s,[xe]:Object.keys(A).reduce((r,o)=>({...r,[o]:0}),{}),[T]:[],[be]:i};if(t instanceof Object&&Object.keys(t).length){const r=(o,c)=>{if(typeof o[c]=="string")o[c]=He(o[c],e),o[c][z]=()=>x[s],a[T].push(o[c]);else if(me(o[c])){const[l,f]=o[c];o[c]=Je(a,l,f),o[c][z]=()=>x[s],a[T].push(o[c])}else o[c]instanceof Object&&(o[c]=Object.keys(o[c]).reduce(r,o[c]));return o};return x[s]=Object.assign(Object.keys(t).reduce(r,t),a),x[s][z]=()=>x[s],x[s]}},I=()=>{const t=[],e=[];t.sort=function(r){const o=Array.prototype.sort.call(this,r);for(let c=0;c<t.length;c++)e[t[c]]=c;return o};const s=r=>t[e[r]]===r;return{add:r=>{s(r)||(e[r]=t.push(r)-1)},remove:r=>{if(!s(r))return;const o=e[r],c=t.pop();c!==r&&(t[o]=c,e[c]=o)},has:s,sparse:e,dense:t,reset:()=>{t.length=0,e.length=0}}},E=Symbol("entityMasks"),Q=Symbol("entityComponents"),M=Symbol("entitySparseSet"),U=Symbol("entityArray"),Ze=1e5,X=0,Ce=Ze,se=()=>Ce,_=[],et=.01,tt=et,st=()=>X,it=new Map,nt=t=>{const e=t[ce]?_.length?_.shift():X++:_.length>Math.round(Ce*tt)?_.shift():X++;if(e>t[oe])throw new Error("bitECS - max entities reached");return t[M].add(e),it.set(e,t),t[ie].forEach(s=>{re(t,s,e)&&ae(s,e)}),t[Q].set(e,new Set),e},Ae=(t,e)=>{if(t[M].has(e)){t[V].forEach(s=>{Oe(t,s,e)}),t[ce]||_.push(e),t[M].remove(e),t[Q].delete(e),t[Le].delete(t[ee].get(e)),t[ee].delete(e);for(let s=0;s<t[E].length;s++)t[E][s][e]=0}},rt=Symbol("$modifier"),V=Symbol("queries"),ie=Symbol("notQueries"),at=Symbol("queryAny"),ot=Symbol("queryAll"),ct=Symbol("queryNone"),C=Symbol("queryMap"),B=Symbol("$dirtyQueries"),Te=Symbol("queryComponents"),Me=Object.freeze([]),ht=t=>e=>{e[C].has(t)||ne(e,t);const s=e[C].get(t);if(s.entered.dense.length===0)return Me;{const i=s.entered.dense.slice();return s.entered.reset(),i}},lt=t=>e=>{e[C].has(t)||ne(e,t);const s=e[C].get(t);if(s.exited.dense.length===0)return Me;{const i=s.exited.dense.slice();return s.exited.reset(),i}},ne=(t,e)=>{const s=[],i=[],n=[];e[Te].forEach(u=>{if(typeof u=="function"&&u[rt]){const[y,he]=u();t[S].has(y)||Z(t,y),he==="not"&&i.push(y),he==="changed"&&(n.push(y),s.push(y))}else t[S].has(u)||Z(t,u),s.push(u)});const a=u=>t[S].get(u),r=s.concat(i).map(a),o=I(),c=[],l=[],f=I(),Y=I(),we=I(),ke=r.map(u=>u.generationId).reduce((u,y)=>(u.includes(y)||u.push(y),u),[]),G=(u,y)=>(u[y.generationId]||(u[y.generationId]=0),u[y.generationId]|=y.bitflag,u),$e=s.map(a).reduce(G,{}),je=i.map(a).reduce(G,{}),Ie=r.reduce(G,{}),_e=s.filter(u=>!u[Se]).map(u=>Object.getOwnPropertySymbols(u).includes(T)?u[T]:[u]).reduce((u,y)=>u.concat(y),[]),R=Object.assign(o,{archetypes:c,changed:l,components:s,notComponents:i,changedComponents:n,allComponents:r,masks:$e,notMasks:je,hasMasks:Ie,generations:ke,flatProps:_e,toRemove:f,entered:Y,exited:we,shadows:[]});t[C].set(e,R),t[V].add(R),r.forEach(u=>{u.queries.add(R)}),i.length&&t[ie].add(R);for(let u=0;u<st();u++){if(!t[M].has(u))continue;re(t,R,u)&&ae(R,u)}},ut=(t,e)=>{const s=Symbol(),i=t.flatProps[e];return Ye(i,s),t.shadows[e]=i[s],i[s]},ft=(t,e)=>{e&&(t.changed=[]);const{flatProps:s,shadows:i}=t;for(let n=0;n<t.dense.length;n++){const a=t.dense[n];let r=!1;for(let o=0;o<s.length;o++){const c=s[o],l=i[o]||ut(t,o);if(ArrayBuffer.isView(c[a])){for(let f=0;f<c[a].length;f++)if(c[a][f]!==l[a][f]){r=!0;break}l[a].set(c[a])}else c[a]!==l[a]&&(r=!0,l[a]=c[a])}r&&t.changed.push(a)}return t.changed},j=(...t)=>{let e,s,i,n;if(Array.isArray(t[0])&&(e=t[0]),e===void 0||e[S]!==void 0)return r=>r?r[U]:e[U];const a=function(r,o=!0){r[C].has(a)||ne(r,a);const c=r[C].get(a);return yt(r),c.changedComponents.length?ft(c,o):c.dense};return a[Te]=e,a[at]=s,a[ot]=i,a[ct]=n,a},re=(t,e,s)=>{const{masks:i,notMasks:n,generations:a}=e;for(let r=0;r<a.length;r++){const o=a[r],c=i[o],l=n[o],f=t[E][o][s];if(l&&f&l||c&&(f&c)!==c)return!1}return!0},ae=(t,e)=>{t.toRemove.remove(e),t.entered.add(e),t.add(e)},dt=t=>{for(let e=t.toRemove.dense.length-1;e>=0;e--){const s=t.toRemove.dense[e];t.toRemove.remove(s),t.remove(s)}},yt=t=>{t[B].size&&(t[B].forEach(dt),t[B].clear())},Oe=(t,e,s)=>{!e.has(s)||e.toRemove.has(s)||(e.toRemove.add(s),t[B].add(e),e.exited.add(s))},S=Symbol("componentMap"),O=(t,e)=>{const s=Xe(t,se());return t&&Object.keys(t).length,s},mt=t=>{t[N]*=2,t[N]>=2**31&&(t[N]=1,t[E].push(new Uint32Array(t[oe])))},Z=(t,e)=>{if(!e)throw new Error("bitECS - Cannot register null or undefined component");const s=new Set,i=new Set,n=new Set;t[V].forEach(a=>{a.allComponents.includes(e)&&s.add(a)}),t[S].set(e,{generationId:t[E].length-1,bitflag:t[N],store:e,queries:s,notQueries:i,changedQueries:n}),mt(t)},pt=(t,e,s)=>{const i=t[S].get(e);if(!i)return!1;const{generationId:n,bitflag:a}=i;return(t[E][n][s]&a)===a},L=(t,e,s,i=!1)=>{if(s===void 0)throw new Error("bitECS - entity is undefined.");if(!t[M].has(s))throw new Error("bitECS - entity does not exist in the world.");if(t[S].has(e)||Z(t,e),pt(t,e,s))return;const n=t[S].get(e),{generationId:a,bitflag:r,queries:o,notQueries:c}=n;t[E][a][s]|=r,o.forEach(l=>{l.toRemove.remove(s);const f=re(t,l,s);f&&(l.exited.remove(s),ae(l,s)),f||(l.entered.remove(s),Oe(t,l,s))}),t[Q].get(s).add(e),i&&Ge(e,s)},oe=Symbol("size"),N=Symbol("bitflag"),vt=Symbol("archetypes"),Le=Symbol("localEntities"),ee=Symbol("localEntityLookup"),ce=Symbol("manualEntityRecycling"),gt=(...t)=>{const e=typeof t[0]=="object"?t[0]:{},s=typeof t[0]=="number"?t[0]:typeof t[1]=="number"?t[1]:se();return bt(e,s),e},bt=(t,e=se())=>(t[oe]=e,t[U]&&t[U].forEach(s=>Ae(t,s)),t[E]=[new Uint32Array(e)],t[Q]=new Map,t[vt]=[],t[M]=I(),t[U]=t[M].dense,t[N]=1,t[S]=new Map,t[C]=new Map,t[V]=new Set,t[ie]=new Set,t[B]=new Set,t[Le]=new Map,t[ee]=new Map,t[ce]=!1,t),pe=(...t)=>e=>{let s=e;for(let i=0;i<t.length;i++){const n=t[i];s=n(s)}return s},b=w,g=(t=>(t[t.RED=0]="RED",t[t.BLUE=1]="BLUE",t[t.GREEN=2]="GREEN",t))(g||{});const p=O({index:b.ui32});function xt(t,e){L(t,p,e),p.index[e]=0}const $=O({x:b.f32,y:b.f32});function St(t,e,s,i){L(t,$,e),$.x[e]=s,$.y[e]=i}const d=O({x:b.f32,y:b.f32});function Et(t,e,s,i){L(t,d,e),d.x[e]=s,d.y[e]=i}const v=O({value:b.f32});function Ct(t,e,s){L(t,v,e),v.value[e]=s}const P=O({value:b.f32});function At(t,e,s){L(t,P,e),P.value[e]=s}const m=O({x:b.f32,y:b.f32});function ve(t,e,s,i){L(t,m,e),m.x[e]=s,m.y[e]=i}class Tt{constructor(){h(this,"_states");h(this,"onKeyDown",e=>{this._states.set(e.code,!0)});h(this,"onKeyUp",e=>{this._states.set(e.code,!1)});h(this,"onBlur",e=>{this._states.forEach((s,i)=>this._states.set(i,!1))});this._states=new Map}getState(e){return this._states.get(e)??!1}attach(e){e.addEventListener("keydown",this.onKeyDown),e.addEventListener("keyup",this.onKeyUp),window.addEventListener("blur",this.onBlur)}detach(e){e.removeEventListener("keydown",this.onKeyDown),e.removeEventListener("keyup",this.onKeyUp),window.removeEventListener("blur",this.onBlur)}}class Mt{constructor(e=new OffscreenCanvas(0,0)){h(this,"texture");h(this,"context");h(this,"events",{resize:new Set});this.texture=e,this.context=this.texture.getContext("2d")}resize(e=300,s=e){this.texture.width=e,this.texture.height=s,this.events.resize.forEach(i=>i({width:e,height:s}))}clear(){this.context.clearRect(0,0,this.texture.width,this.texture.height)}}class Ot extends Mt{constructor(e=document.createElement("canvas")){super(e)}isClientSize(){return this.texture.width==this.texture.clientWidth&&this.texture.height==this.texture.clientHeight}toClientSize(){this.resize(this.texture.clientWidth,this.texture.clientHeight)}}const k=O({value:b.ui8});function Lt(t,e,s){L(t,k,e),k.value[e]=s}function ge(t,{x:e=0,y:s=0,radius:i=5,appearence:n=g.BLUE}={}){const a=nt(t);return Et(t,a,e,s),Ct(t,a,i),Lt(t,a,n),a}var Re=(t=>(t[t.CIRCLE_COLLISION=0]="CIRCLE_COLLISION",t))(Re||{});function Rt({entity:t,check:e=!1}={}){return{type:Re.CIRCLE_COLLISION,entity:t,check:e}}function wt({world:t,circleInstances:e,quadtree:s}){const i=j([d,v,p]),n=ht(i),a=lt(i);return()=>{s.clear();for(const r of n(t)){const o=new K({x:d.x[r],y:d.y[r],r:v.value[r],data:Rt({entity:r})});p.index[r]=e.push(o)-1}for(const r of a(t)){const o=e.pop();p.index[r]!==e.length&&(p.index[o.data.entity]=p.index[r],e[p.index[r]]=o)}for(const r of i(t)){const o=e[p.index[r]];o.data.check=!1,o.x=d.x[r]-v.value[r],o.y=d.y[r]-v.value[r],o.r=v.value[r],s.insert(o)}}}function kt(t){const e=j([d,m]),s=j([m,$]);return()=>{for(const i of e(t))d.x[i]+=m.x[i],d.y[i]+=m.y[i];for(const i of s(t))m.x[i]*=$.x[i],m.y[i]*=$.y[i]}}const W=[];W[g.RED]={fillColor:"#ff000055",strokeColor:"#ff0000"};W[g.BLUE]={fillColor:"#0000ff55",strokeColor:"#0000ff"};W[g.GREEN]={fillColor:"#00ff0055",strokeColor:"#00ff00"};const $t=Math.PI*2;function jt({world:t,context:e,camera:s,circleInstances:i}){const n=j([d,v,k]),a=j([d,v,k,p]);return()=>{for(const c of a(t)){const l=i[p.index[c]];k.value[c]=l.data.check?g.RED:g.BLUE}e.clearRect(0,0,e.canvas.width,e.canvas.height),e.save();const{width:r,height:o}=e.canvas;e.translate(r/2,o/2),e.scale(s.scale,s.scale),e.translate(-s.x,-s.y);for(let c of n(t)){const l=W[k.value[c]];e.fillStyle=l.fillColor,e.strokeStyle=l.strokeColor,e.beginPath(),e.arc(d.x[c],d.y[c],v.value[c],0,$t),e.fill(),e.stroke()}e.restore()}}class It{constructor({x:e=0,y:s=e,scale:i=1}={}){h(this,"x");h(this,"y");h(this,"scale");this.x=e,this.y=s,this.scale=i}}function _t(t){const e=j([P]);return()=>{for(const s of e(t))P.value[s]-=1,P.value[s]<=0&&Ae(t,s)}}class Ut{constructor(e){h(this,"application");h(this,"screen");h(this,"world");h(this,"camera");h(this,"keyboard");h(this,"player");h(this,"quadtree");h(this,"updateSystems");h(this,"renderSystems");h(this,"spawnRandomCircle",()=>{const e=ge(this.world,{appearence:Math.random()>.5?g.RED:g.BLUE});At(this.world,e,Math.random()*300),ve(this.world,e,Math.random()-.5,Math.random()-.5),xt(this.world,e)});this.application=e.application,this.screen=new Ot,this.world=gt(),this.camera=new It,this.keyboard=new Tt,this.player=ge(this.world,{radius:10,appearence:g.GREEN}),ve(this.world,this.player,0,0),St(this.world,this.player,.9,.9),this.quadtree=new te({x:-500,y:-500,width:1e3,height:1e3,maxObjects:10});const s=[];this.renderSystems=pe(jt({world:this.world,context:this.screen.context,camera:this.camera,circleInstances:s})),this.updateSystems=pe(kt(this.world),_t(this.world),wt({world:this.world,quadtree:this.quadtree,circleInstances:s}))}async enter(){const e=this.application.timer.interval(this.spawnRandomCircle,0,33.333333333333336);return this.keyboard.attach(document.body),()=>{e.cancel()}}async leave(){this.keyboard.detach(document.body)}render(){this.screen.isClientSize()||this.screen.toClientSize();const s=d.x[this.player]-this.camera.x,i=d.y[this.player]-this.camera.y;this.camera.x+=s*.1,this.camera.y+=i*.1,this.renderSystems()}update(){(this.keyboard.getState("ArrowRight")||this.keyboard.getState("KeyD"))&&(m.x[this.player]+=1),(this.keyboard.getState("ArrowLeft")||this.keyboard.getState("KeyA"))&&(m.x[this.player]-=1),(this.keyboard.getState("ArrowUp")||this.keyboard.getState("KeyW"))&&(m.y[this.player]-=1),(this.keyboard.getState("ArrowDown")||this.keyboard.getState("KeyS"))&&(m.y[this.player]+=1),this.updateSystems();const e=this.quadtree.retrieve(new K({x:d.x[this.player],y:d.y[this.player],r:v.value[this.player]}));for(const s of e)s.data.check=!0}}async function Bt(){const t=new ze,e=new Ut({application:t});await t.enterScene(e)&&document.querySelector("#app").append(e.screen.texture)}document.addEventListener("DOMContentLoaded",Bt);
